<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    body { background-color: #f5f5f5; padding: 20px; }
    .container-main { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .section-title { background: #4a4a4a; color: white; padding: 10px; margin: 20px 0 10px; font-weight: bold; }
    .eval-table th { background: #f9f9f9; }
    @media print { .no-print { display: none; } .container-main { box-shadow: none; padding: 0; } }
  </style>
  <title>実習評価システム</title>
</head>
<body>
  <div id="login-screen" class="container" style="max-width: 400px; margin-top: 100px;">
    <div class="box">
      <h2 class="title is-4 has-text-centered">実習評価システム ログイン</h2>
      <div class="field">
        <label class="label">学籍番号</label>
        <input class="input" type="text" id="user-id">
      </div>
      <div class="field">
        <label class="label">パスワード</label>
        <input class="input" type="password" id="user-pw">
      </div>
      <button class="button is-link is-fullwidth" id="btn-login" onclick="onLogin()">ログイン</button>
    </div>
  </div>

  <div id="app-screen" class="container-main" style="display: none;">
    <div class="level no-print">
      <div class="level-left"><h1 class="title is-4">実習成績評価表</h1></div>
      <div class="level-right">
        <button class="button is-success mr-2" onclick="onSave()">保存/更新</button>
        <button class="button is-light" onclick="window.print()">印刷</button>
      </div>
    </div>

    <div class="box is-light">
      <p><strong>学籍番号:</strong> <span id="view-st-id"></span></p>
      <p><strong>氏名:</strong> <span id="view-st-name"></span></p>
    </div>

    <div id="dynamic-form"></div>

    <div class="section-title">Ｅ 総合評価</div>
    <div id="radio-E" class="p-3"></div>

    <div class="section-title">Ｆ 総評</div>
    <textarea id="text-F" class="textarea" rows="4"></textarea>

    <div class="section-title">Ｇ アドバイス</div>
    <textarea id="text-G" class="textarea" rows="4"></textarea>

    <div class="mt-6 no-print">
      <button class="button is-primary is-large is-fullwidth" onclick="onSave()">スプレッドシートに保存</button>
    </div>
  </div>

<script>
  // ★ここに新しいURLを貼り付け
  const GAS_URL = "https://script.google.com/macros/s/AKfycbz9ACnaVJA0-WJSsSXUkfDCcre09URSMx0NkTp2p7HqlTqTy2w2ZCS_kT6nGaulh_3w2w/exec";

  const config = [
    { id: 'A', title: '基本的知識', items: ['利用者課題理解', '業務内容理解', '組織・機能理解', '社会資源理解'] },
    { id: 'B', title: '基本的技術', items: ['共感的態度', '技術習得', '記録能力'] },
    { id: 'C', title: '実習態度', items: ['マナー', '意欲', '関わり', '人権尊重', '指導を仰ぐ', '協働'] },
    { id: 'D', title: '変容', items: ['目標達成', '援助関係', '現場理解', '技術向上', '自己理解'] }
  ];

  function initForm() {
    let html = '';
    config.forEach(sec => {
      html += `<div class="section-title">${sec.id} ${sec.title}</div><table class="table is-fullwidth eval-table">`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</table><label class="label is-small">所見</label><textarea class="textarea mb-4" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('dynamic-form').innerHTML = html;
    document.getElementById('radio-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5,4,3,2,1,'非該当'].map(v => 
      `<label class="radio mr-2"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  async function callGAS(payload) {
    // 外部通信(fetch)の設定
    const response = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "text/plain;charset=utf-8" }
    });
    return await response.json();
  }

  async function onLogin() {
    const id = document.getElementById('user-id').value;
    const pass = document.getElementById('user-pw').value;
    const btn = document.getElementById('btn-login');

    if(!id || !pass) return alert("入力してください");
    btn.classList.add('is-loading');

    try {
      const res = await callGAS({ method: 'login', id: id, pass: pass });
      if(res.success) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'block';
        document.getElementById('view-st-id').innerText = res.user.id;
        document.getElementById('view-st-name').innerText = res.user.name;
        if(res.savedData) loadSavedData(res.savedData);
      } else {
        alert("ログインに失敗しました。学籍番号かパスワードが違います。");
      }
    } catch(e) {
      alert("通信エラーが発生しました。GASのデプロイ設定(全員)を確認してください。\n" + e);
    } finally {
      btn.classList.remove('is-loading');
    }
  }

  function loadSavedData(data) {
    let idx = 4; // 学籍番号, 氏名, 科目, 施設の後から
    config.forEach(sec => {
      sec.items.forEach((_, i) => {
        const val = data[idx++];
        const rad = document.querySelector(`input[name="${sec.id}${i+1}"][value="${val}"]`);
        if(rad) rad.checked = true;
      });
      document.getElementById('view-' + sec.id).value = data[idx++] || "";
    });
    const valE = data[idx++];
    const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
    if(radE) radE.checked = true;
    document.getElementById('text-F').value = data[idx++] || "";
    document.getElementById('text-G').value = data[idx++] || "";
  }

  async function onSave() {
    const id = document.getElementById('view-st-id').innerText;
    const name = document.getElementById('view-st-name').innerText;
    let formData = [id, name, "ソーシャルワーク実習", "実習施設名"];

    config.forEach(sec => {
      sec.items.forEach((_, i) => {
        const sel = document.querySelector(`input[name="${sec.id}${i+1}"]:checked`);
        formData.push(sel ? sel.value : "");
      });
      formData.push(document.getElementById('view-' + sec.id).value);
    });

    const selE = document.querySelector(`input[name="E"]:checked`);
    formData.push(selE ? selE.value : "");
    formData.push(document.getElementById('text-F').value);
    formData.push(document.getElementById('text-G').value);

    try {
      const res = await callGAS({ method: 'save', formData: formData });
      alert(res.message);
    } catch(e) {
      alert("保存エラー: " + e);
    }
  }

  initForm();
</script>
</body>
</html>    </div>
    <div class="notification is-light">
      学籍番号: <span id="st-id"></span> / 氏名: <span id="st-name"></span>
    </div>
    <div id="form-content"></div>
    <div class="section-header">Ｅ 総合評価</div>
    <div id="eval-E" class="p-3"></div>
    <div class="section-header">Ｆ 総評</div>
    <textarea class="textarea mt-2" id="comment-F"></textarea>
    <div class="section-header">Ｇ アドバイス</div>
    <textarea class="textarea mt-2" id="comment-G"></textarea>
    <button class="button is-primary is-large is-fullwidth mt-5 no-print" onclick="handleSave()">保存する</button>
  </div>

<script>
  // ★重要：ここにあなたのデプロイURLを貼り付けてください
  const GAS_URL = "https://script.google.com/macros/s/AKfycbwnBwlwhWG8f6mePyO38cdjJ8xEff2QUdJPb7tDbntjawqH-wy_RPa9ppejaSM63KrIrA/exec";

  const sections = [
    { id: 'A', title: '基本的知識', items: ['利用者理解', '業務理解', '組織理解', '資源理解'] },
    { id: 'B', title: '基本的技術', items: ['共感的態度', '技術習得', '記録能力'] },
    { id: 'C', title: '実習態度', items: ['規則遵守', '意欲', '積極性', '人権尊重', '指導を仰ぐ', '協働'] },
    { id: 'D', title: '変容', items: ['目標達成', '援助関係', '現場理解', '技術向上', '自己理解'] }
  ];

  function init() {
    let html = '';
    sections.forEach(sec => {
      html += `<div class="section-header">${sec.title}</div><table class="table is-fullwidth eval-table">`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</table><label class="label is-small">所見</label><textarea class="textarea mb-3" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('form-content').innerHTML = html;
    document.getElementById('eval-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5, 4, 3, 2, 1, '非該当'].map(v => 
      `<label class="radio mr-2"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  // GASと通信する汎用関数 (fetchを使用)
  async function callGAS(data) {
    const response = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
    return await response.json();
  }

  async function handleLogin() {
    const id = document.getElementById('login-id').value;
    const pass = document.getElementById('login-pw').value;
    const btn = document.getElementById('login-btn');
    
    btn.classList.add('is-loading');
    try {
      const res = await callGAS({ method: 'login', id: id, pass: pass });
      if (res.success) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('st-id').innerText = res.user.id;
        document.getElementById('st-name').innerText = res.user.name;
        // 保存データがあれば反映（実装略）
      } else { alert("ログイン失敗"); }
    } catch (e) { alert("エラー: " + e); }
    btn.classList.remove('is-loading');
  }

  async function handleSave() {
    // フォームからデータを集める処理 (以前のロジックと同じ)
    const id = document.getElementById('st-id').innerText;
    let payload = [id, document.getElementById('st-name').innerText, "SW実習", "施設名"];
    // ...各項目のpush処理...
    
    const res = await callGAS({ method: 'save', formData: payload });
    alert(res.message);
  }

  init();
</script>
</body>
</html>        <button class="button is-light" onclick="window.print()">印刷する</button>
      </div>
    </div>

    <div class="columns is-bordered mb-4" style="border: 2px solid #000; padding: 10px;">
      <div class="column"><strong>大学：</strong>種智院大学 [cite: 2]</div>
      <div class="column"><strong>学籍番号：</strong><span id="st-id"></span></div>
      <div class="column"><strong>氏名：</strong><span id="st-name"></span></div>
      <div class="column"><strong>科目名：</strong>ソーシャルワーク実習 [cite: 2]</div>
    </div>

    <p class="is-size-7 mb-4">※ 5：大変よい / 4：よい / 3：ふつう / 2：努力を要する / 1：かなり努力を要する / 非該当 [cite: 10]</p>

    <div id="form-content"></div>

    <div class="section-header">Ｅ 総合評価 [cite: 25]</div>
    <div class="p-3 box mt-2" id="eval-E"></div>

    <div class="section-header">Ｆ 実習生に関する総評 [cite: 27]</div>
    <textarea class="textarea mt-2" id="comment-F" rows="4"></textarea>

    <div class="section-header">Ｇ アドバイス・長所・短所 [cite: 28]</div>
    <textarea class="textarea mt-2" id="comment-G" rows="4"></textarea>

    <div class="mt-6 has-text-centered no-print">
      <p class="help mb-3">入力を完了したら「保存」ボタンを押してください。</p>
      <button class="button is-large is-primary" onclick="handleSave()">データをスプレッドシートへ保存</button>
    </div>
  </div>

<script>
  const sections = [
    { id: 'A', title: '基本的知識の理解・習得の状況', items: [
      '施設・機関の利用者及びその生活課題・ニーズに関する理解 [cite: 14]',
      '実習した職種の業務内容に関する理解 [cite: 14]',
      '施設・機関の法的根拠・目的・組織・業務体系等に対する理解 [cite: 14]',
      '関連する他施設・制度・社会資源に関する理解 [cite: 14]'
    ]},
    { id: 'B', title: '基本的技術・技能の習得の状況', items: [
      '利用者に対して共感的・理解的に接する技能 [cite: 17]',
      '基本的技術（面接、観察、ケア、環境設備等）の習得 [cite: 17]',
      '実習日誌や各種記録を的確に作成する能力 [cite: 17]'
    ]},
    { id: 'C', title: '実習態度の状況', items: [
      '規則の遵守（適切な服装、言葉遣い等、マナーも含む） [cite: 20]',
      '職務を習得しようとする意欲、積極性 [cite: 20]',
      '利用者に積極的に関わろうとする態度 [cite: 20]',
      '利用者の人権・人格を尊重しようとする態度 [cite: 20]',
      '実習指導者の指導・助言を積極的に求めようとする態度 [cite: 20]',
      '他職種、他職員と協働しようとする態度 [cite: 20]'
    ]},
    { id: 'D', title: '実習を通した変容', items: [
      '各自の実習目標の達成度 [cite: 23]',
      '利用者とそのニーズに対する理解や援助関係を深めた [cite: 23]',
      '実践現場に関する理解を深めた [cite: 23]',
      '実践技術・技能を深めた [cite: 23]',
      '自己理解を深めた [cite: 23]'
    ]}
  ];

  function init() {
    let html = '';
    sections.forEach(sec => {
      html += `<div class="section-header">${sec.id} ${sec.title}</div>`;
      html += `<table class="table is-fullwidth eval-table"><thead><tr><th>評価項目</th><th>評定尺度 [cite: 10]</th></tr></thead><tbody>`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</tbody></table><label class="label is-small">【${sec.id} 所見】</label><textarea class="textarea mb-3" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('form-content').innerHTML = html;
    document.getElementById('eval-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5, 4, 3, 2, 1, '非該当'].map(v => 
      `<label class="radio-label"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  function handleLogin() {
    const id = document.getElementById('login-id').value;
    const pw = document.getElementById('login-pw').value;
    google.script.run.withSuccessHandler(res => {
      if(res.success) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('st-id').innerText = res.user.id;
        document.getElementById('st-name').innerText = res.user.name;
        if(res.savedData) loadData(res.savedData);
      } else { alert("ログイン情報が正しくありません。"); }
    }).login(id, pw);
  }

  function loadData(data) {
    // スプレッドシートの各列(A-G)をフォームに復元
    // data[0]=学籍番号, data[1]=氏名... A1はdata[4]から開始
    let idx = 4;
    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const val = data[idx++];
        const rad = document.querySelector(`input[name="${sec.id}${i+1}"][value="${val}"]`);
        if(rad) rad.checked = true;
      });
      document.getElementById('view-' + sec.id).value = data[idx++];
    });
    // E, F, Gの復元
    const valE = data[idx++];
    const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
    if(radE) radE.checked = true;
    document.getElementById('comment-F').value = data[idx++];
    document.getElementById('comment-G').value = data[idx++];
  }

  function handleSave() {
    const id = document.getElementById('st-id').innerText;
    const name = document.getElementById('st-name').innerText;
    let payload = [id, name, "ソーシャルワーク実習", "実習施設名"];

    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const sel = document.querySelector(`input[name="${sec.id}${i+1}"]:checked`);
        payload.push(sel ? sel.value : "");
      });
      payload.push(document.getElementById('view-' + sec.id).value);
    });

    const selE = document.querySelector(`input[name="E"]:checked`);
    payload.push(selE ? selE.value : "");
    payload.push(document.getElementById('comment-F').value);
    payload.push(document.getElementById('comment-G').value);

    google.script.run.withSuccessHandler(msg => alert(msg)).saveData(payload);
  }

  init();
</script>
</body>
</html>        <button class="button is-light" onclick="window.print()">印刷する</button>
      </div>
    </div>

    <div class="columns is-bordered mb-4" style="border: 2px solid #000; padding: 10px;">
      <div class="column"><strong>大学：</strong>種智院大学 [cite: 2]</div>
      <div class="column"><strong>学籍番号：</strong><span id="st-id"></span></div>
      <div class="column"><strong>氏名：</strong><span id="st-name"></span></div>
      <div class="column"><strong>科目名：</strong>ソーシャルワーク実習 [cite: 2]</div>
    </div>

    <p class="is-size-7 mb-4">※ 5：大変よい / 4：よい / 3：ふつう / 2：努力を要する / 1：かなり努力を要する / 非該当 [cite: 10]</p>

    <div id="form-content"></div>

    <div class="section-header">Ｅ 総合評価 [cite: 25]</div>
    <div class="p-3 box mt-2" id="eval-E"></div>

    <div class="section-header">Ｆ 実習生に関する総評 [cite: 27]</div>
    <textarea class="textarea mt-2" id="comment-F" rows="4"></textarea>

    <div class="section-header">Ｇ アドバイス・長所・短所 [cite: 28]</div>
    <textarea class="textarea mt-2" id="comment-G" rows="4"></textarea>

    <div class="mt-6 has-text-centered no-print">
      <p class="help mb-3">入力を完了したら「保存」ボタンを押してください。</p>
      <button class="button is-large is-primary" onclick="handleSave()">データをスプレッドシートへ保存</button>
    </div>
  </div>

<script>
  const sections = [
    { id: 'A', title: '基本的知識の理解・習得の状況', items: [
      '施設・機関の利用者及びその生活課題・ニーズに関する理解 [cite: 14]',
      '実習した職種の業務内容に関する理解 [cite: 14]',
      '施設・機関の法的根拠・目的・組織・業務体系等に対する理解 [cite: 14]',
      '関連する他施設・制度・社会資源に関する理解 [cite: 14]'
    ]},
    { id: 'B', title: '基本的技術・技能の習得の状況', items: [
      '利用者に対して共感的・理解的に接する技能 [cite: 17]',
      '基本的技術（面接、観察、ケア、環境設備等）の習得 [cite: 17]',
      '実習日誌や各種記録を的確に作成する能力 [cite: 17]'
    ]},
    { id: 'C', title: '実習態度の状況', items: [
      '規則の遵守（適切な服装、言葉遣い等、マナーも含む） [cite: 20]',
      '職務を習得しようとする意欲、積極性 [cite: 20]',
      '利用者に積極的に関わろうとする態度 [cite: 20]',
      '利用者の人権・人格を尊重しようとする態度 [cite: 20]',
      '実習指導者の指導・助言を積極的に求めようとする態度 [cite: 20]',
      '他職種、他職員と協働しようとする態度 [cite: 20]'
    ]},
    { id: 'D', title: '実習を通した変容', items: [
      '各自の実習目標の達成度 [cite: 23]',
      '利用者とそのニーズに対する理解や援助関係を深めた [cite: 23]',
      '実践現場に関する理解を深めた [cite: 23]',
      '実践技術・技能を深めた [cite: 23]',
      '自己理解を深めた [cite: 23]'
    ]}
  ];

  function init() {
    let html = '';
    sections.forEach(sec => {
      html += `<div class="section-header">${sec.id} ${sec.title}</div>`;
      html += `<table class="table is-fullwidth eval-table"><thead><tr><th>評価項目</th><th>評定尺度 [cite: 10]</th></tr></thead><tbody>`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</tbody></table><label class="label is-small">【${sec.id} 所見】</label><textarea class="textarea mb-3" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('form-content').innerHTML = html;
    document.getElementById('eval-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5, 4, 3, 2, 1, '非該当'].map(v => 
      `<label class="radio-label"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  function handleLogin() {
    const id = document.getElementById('login-id').value;
    const pw = document.getElementById('login-pw').value;
    google.script.run.withSuccessHandler(res => {
      if(res.success) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('st-id').innerText = res.user.id;
        document.getElementById('st-name').innerText = res.user.name;
        if(res.savedData) loadData(res.savedData);
      } else { alert("ログイン情報が正しくありません。"); }
    }).login(id, pw);
  }

  function loadData(data) {
    // スプレッドシートの各列(A-G)をフォームに復元
    // data[0]=学籍番号, data[1]=氏名... A1はdata[4]から開始
    let idx = 4;
    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const val = data[idx++];
        const rad = document.querySelector(`input[name="${sec.id}${i+1}"][value="${val}"]`);
        if(rad) rad.checked = true;
      });
      document.getElementById('view-' + sec.id).value = data[idx++];
    });
    // E, F, Gの復元
    const valE = data[idx++];
    const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
    if(radE) radE.checked = true;
    document.getElementById('comment-F').value = data[idx++];
    document.getElementById('comment-G').value = data[idx++];
  }

  function handleSave() {
    const id = document.getElementById('st-id').innerText;
    const name = document.getElementById('st-name').innerText;
    let payload = [id, name, "ソーシャルワーク実習", "実習施設名"];

    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const sel = document.querySelector(`input[name="${sec.id}${i+1}"]:checked`);
        payload.push(sel ? sel.value : "");
      });
      payload.push(document.getElementById('view-' + sec.id).value);
    });

    const selE = document.querySelector(`input[name="E"]:checked`);
    payload.push(selE ? selE.value : "");
    payload.push(document.getElementById('comment-F').value);
    payload.push(document.getElementById('comment-G').value);

    google.script.run.withSuccessHandler(msg => alert(msg)).saveData(payload);
  }

  init();
</script>
</body>
</html>
