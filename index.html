<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実習成績評価システム</title>
    <style>
        /* 共通スタイル */
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background-color: #f0f2f5; margin: 0; color: #333; }
        .screen { display: none; min-height: 100vh; }
        .active { display: flex; flex-direction: column; }
        
        /* ログイン画面 */
        #loginScreen { align-items: center; justify-content: center; background: #dee2e6; }
        .login-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); width: 90%; max-width: 360px; }
        
        /* 評価画面（メイン） */
        #mainApp { display: none; } /* 初期状態は非表示 */
        #mainApp.active { display: block; } 
        .app-container { max-width: 800px; margin: 20px auto; padding: 15px; }
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        
        /* 入力パーツ */
        .form-control { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; margin-top: 5px; }
        h2 { font-size: 1.1rem; color: #1a73e8; border-left: 5px solid #1a73e8; padding-left: 10px; margin-bottom: 20px; }
        .eval-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .radio-group { display: flex; gap: 8px; }
        .btn { padding: 12px 24px; cursor: pointer; border-radius: 6px; font-weight: bold; border: none; font-size: 16px; transition: 0.2s; }
        .btn--primary { background: #1a73e8; color: white; width: 100%; }
        .btn--save { background: #28a745; color: white; width: 100%; font-size: 1.2rem; padding: 18px; margin-top: 20px; }
        .btn--logout { background: #6c757d; color: white; padding: 6px 12px; font-size: 14px; }
        
        /* レイアウト補助 */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-att { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
        label { font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen active">
        <div class="login-card">
            <h1 style="text-align:center; font-size: 1.4rem; margin-bottom:25px;">実習評価システム</h1>
            <form id="loginForm">
                <div style="margin-bottom:15px;">
                    <label>学籍番号</label>
                    <input type="text" id="studentId" class="form-control" required placeholder="例: 1234567">
                </div>
                <div style="margin-bottom:25px;">
                    <label>パスワード</label>
                    <input type="password" id="password" class="form-control" required placeholder="パスワードを入力">
                </div>
                <button type="submit" class="btn btn--primary" id="loginBtn">ログイン</button>
                <p id="loginError" style="color:red; text-align:center; margin-top:15px; font-size:14px;"></p>
            </form>
        </div>
    </div>

    <div id="mainApp" class="screen">
        <div class="app-container">
            <header style="display:flex; justify-content: space-between; align-items: center; background:white; padding:15px; border-radius:8px; margin-bottom:20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                <div><strong>学籍番号:</strong> <span id="displayId"></span><br><strong>氏名:</strong> <span id="currentUserName"></span> 様</div>
                <button onclick="location.reload()" class="btn btn--logout">ログアウト</button>
            </header>

            <form id="evaluationForm">
                <section class="card">
                    <h2>施設・機関情報</h2>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>種別</label><input type="text" id="info_type" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>設置主体名</label><input type="text" id="info_owner" class="form-control"></div>
                    </div>
                    <div style="margin-bottom:10px;"><label>施設・機関名</label><input type="text" id="info_facility" class="form-control"></div>
                    <div style="margin-bottom:10px;"><label>所在地</label><input type="text" id="info_address" class="form-control"></div>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>代表者</label><input type="text" id="info_rep" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>実習指導者</label><input type="text" id="info_mentor" class="form-control"></div>
                    </div>
                </section>

                <section class="card">
                    <h2>実習期間・出席状況</h2>
                    <div class="grid-2">
                        <div><label>開始日</label><input type="date" id="date_start" class="form-control"></div>
                        <div><label>終了日</label><input type="date" id="date_end" class="form-control"></div>
                    </div>
                    <div style="margin:15px 0;">
                        <label>通い・宿泊の別：</label>
                        <input type="radio" name="stay_type" value="通い" id="stay_1"> <label for="stay_1">通い</label>
                        <input type="radio" name="stay_type" value="宿泊" id="stay_2" style="margin-left:15px;"> <label for="stay_2">宿泊</label>
                    </div>
                    <div class="grid-att">
                        <div><label style="font-size:11px;">出席すべき日数</label><input type="number" id="att_must" class="form-control"></div>
                        <div><label style="font-size:11px;">出席日数</label><input type="number" id="att_done" class="form-control"></div>
                        <div><label style="font-size:11px;">欠席日数</label><input type="number" id="att_absent" class="form-control"></div>
                        <div><label style="font-size:11px;">遅刻</label><input type="number" id="att_late" class="form-control"></div>
                        <div><label style="font-size:11px;">早退</label><input type="number" id="att_early" class="form-control"></div>
                    </div>
                    <div style="margin-top:15px;"><label>備考（補充日 等）</label><input type="text" id="att_memo" class="form-control"></div>
                </section>

                <div id="dynamicSections"></div>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around; padding: 10px;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 総評 / Ｇ アドバイス</h2>
                    <div style="margin-bottom:15px;"><label>Ｆ 実習生に関する総評</label><textarea id="comment-F" class="form-control" rows="6"></textarea></div>
                    <div><label>Ｇ 今後の学習に対するアドバイス</label><textarea id="comment-G" class="form-control" rows="6"></textarea></div>
                </section>

                <button type="submit" class="btn btn--save" id="saveBtn">スプレッドシートを更新保存</button>
            </form>
        </div>
    </div>

    <script>
        // ★ここに最新のGASウェブアプリURLを貼り付けてください
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzBuU4I8fuECSldym_-c2KDY8gVFGCwAIyjZdMqWr5nH88u9xiqgBbU71ylaA56GQyy8A/exec";

        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術の向上', '自己理解の深化']
        };

        function initForm() {
            let html = '';
            for (let key in evalConfig) {
                html += `<section class="card"><h2>${key}項目</h2>`;
                evalConfig[key].forEach((text, i) => {
                    html += `<div class="eval-row">
                        <div style="font-size:14px; flex:1; padding-right:10px;">${text}</div>
                        <div class="radio-group">${makeRadios(key+(i+1))}</div>
                    </div>`;
                });
                html += `<p style="margin-top:15px; font-weight:bold; font-size:14px;">【${key} 所見】</p><textarea id="view-${key}" class="form-control"></textarea></section>`;
            }
            document.getElementById('dynamicSections').innerHTML = html;
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `
                <label style="font-size:11px; text-align:center;"><input type="radio" name="${name}" value="${v}" required><br>${v}</label>
            `).join('');
        }

        // 通信関数（CORSエラーを回避するため headers を最小限にする）
        async function postData(payload) {
            const response = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error("サーバー通信エラー");
            return await response.json();
        }

        // ログイン処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('loginError');
            btn.disabled = true; btn.innerText = "認証中...";
            err.innerText = "";

            try {
                const result = await postData({
                    action: "login",
                    studentId: document.getElementById('studentId').value,
                    password: document.getElementById('password').value
                });

                if (result.success) {
                    document.getElementById('displayId').innerText = result.id;
                    document.getElementById('currentUserName').innerText = result.userName;
                    
                    // 以前のデータがあれば流し込む
                    if (result.savedData) fillForm(result.savedData);
                    
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                    window.scrollTo(0, 0);
                } else {
                    err.innerText = "学籍番号またはパスワードが違います";
                }
            } catch(e) {
                err.innerText = "通信エラー: GASの設定（全員アクセス可能か等）を確認してください";
                console.error(e);
            } finally {
                btn.disabled = false; btn.innerText = "ログイン";
            }
        });

        // 既存データの自動反映
        function fillForm(d) {
            const setVal = (id, val) => { const el = document.getElementById(id); if(el) el.value = val || ""; };
            setVal('info_type', d[3]);
            setVal('info_owner', d[4]);
            setVal('info_facility', d[5]);
            setVal('info_address', d[6]);
            setVal('info_rep', d[7]);
            setVal('info_mentor', d[8]);
            setVal('date_start', d[9]);
            setVal('date_end', d[10]);
            if(d[11]) {
                const r = document.querySelector(`input[name="stay_type"][value="${d[11]}"]`);
                if(r) r.checked = true;
            }
            setVal('att_must', d[12]);
            setVal('att_done', d[13]);
            setVal('att_absent', d[14]);
            setVal('att_late', d[15]);
            setVal('att_early', d[16]);
            setVal('att_memo', d[17]);

            let col = 18;
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const val = d[col++];
                    const r = document.querySelector(`input[name="${key}${i+1}"][value="${val}"]`);
                    if(r) r.checked = true;
                });
                setVal(`view-${key}`, d[col++]);
            }
            const valE = d[col++];
            const rE = document.querySelector(`input[name="E"][value="${valE}"]`);
            if(rE) rE.checked = true;
            setVal('comment-F', d[col++]);
            setVal('comment-G', d[col++]);
        }

        // 保存（更新）処理
        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "更新中...";

            const formData = [
                document.getElementById('displayId').innerText,
                document.getElementById('currentUserName').innerText,
                "ソーシャルワーク実習",
                document.getElementById('info_type').value,
                document.getElementById('info_owner').value,
                document.getElementById('info_facility').value,
                document.getElementById('info_address').value,
                document.getElementById('info_rep').value,
                document.getElementById('info_mentor').value,
                document.getElementById('date_start').value,
                document.getElementById('date_end').value,
                (document.querySelector('input[name="stay_type"]:checked') || {}).value || "",
                document.getElementById('att_must').value,
                document.getElementById('att_done').value,
                document.getElementById('att_absent').value,
                document.getElementById('att_late').value,
                document.getElementById('att_early').value,
                document.getElementById('att_memo').value
            ];

            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const sel = document.querySelector(`input[name="${key}${i+1}"]:checked`);
                    formData.push(sel ? sel.value : "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            formData.push((document.querySelector('input[name="E"]:checked') || {}).value || "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await postData({ action: "save", formData });
                alert("スプレッドシートを更新しました！");
            } catch(e) {
                alert("保存エラーが発生しました。");
            } finally {
                btn.disabled = false; btn.innerText = "スプレッドシートを更新保存";
            }
        });

        initForm();
    </script>
</body>
</html>                    <input type="text" id="studentId" class="form-control" required>
                </div>
                <div style="margin-bottom:20px;">
                    <label>パスワード</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn--primary" id="loginBtn">ログイン</button>
                <p id="loginError" style="color:red; text-align:center; margin-top:15px;"></p>
            </form>
        </div>
    </div>

    <div id="mainApp" class="screen">
        <div class="app-container">
            <header style="display:flex; justify-content: space-between; background:white; padding:15px; border-radius:8px; margin-bottom:20px;">
                <div><strong>学籍番号:</strong> <span id="displayId"></span><br><strong>氏名:</strong> <span id="currentUserName"></span></div>
                <button onclick="location.reload()" class="btn" style="background:#dc3545; color:white; padding:8px 15px;">ログアウト</button>
            </header>

            <form id="evaluationForm">
                <section class="card">
                    <h2>施設・機関情報</h2>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>種別</label><input type="text" id="info_type" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>設置主体名</label><input type="text" id="info_owner" class="form-control"></div>
                    </div>
                    <div style="margin-bottom:10px;"><label>施設・機関名</label><input type="text" id="info_facility" class="form-control"></div>
                    <div style="margin-bottom:10px;"><label>所在地</label><input type="text" id="info_address" class="form-control"></div>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>代表者</label><input type="text" id="info_rep" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>実習指導者</label><input type="text" id="info_mentor" class="form-control"></div>
                    </div>
                </section>

                <section class="card">
                    <h2>実習期間・出席状況</h2>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>開始日</label><input type="date" id="date_start" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>終了日</label><input type="date" id="date_end" class="form-control"></div>
                    </div>
                    <div style="margin-bottom:15px;">
                        <label>通い・宿泊の別：</label>
                        <input type="radio" name="stay_type" value="通い" id="stay_1"> <label for="stay_1">通い</label>
                        <input type="radio" name="stay_type" value="宿泊" id="stay_2" style="margin-left:15px;"> <label for="stay_2">宿泊</label>
                    </div>
                    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap:10px;">
                        <div><label style="font-size:12px;">出席すべき日数</label><input type="number" id="att_must" class="form-control"></div>
                        <div><label style="font-size:12px;">出席日数</label><input type="number" id="att_done" class="form-control"></div>
                        <div><label style="font-size:12px;">欠席</label><input type="number" id="att_absent" class="form-control"></div>
                        <div><label style="font-size:12px;">遅刻</label><input type="number" id="att_late" class="form-control"></div>
                        <div><label style="font-size:12px;">早退</label><input type="number" id="att_early" class="form-control"></div>
                    </div>
                </section>

                <div id="dynamicSections"></div>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around; padding: 10px;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 総評 / Ｇ アドバイス</h2>
                    <label>Ｆ 実習生に関する総評</label>
                    <textarea id="comment-F" class="form-control" rows="6" style="margin-bottom:20px;"></textarea>
                    <label>Ｇ 今後の学習に対するアドバイス</label>
                    <textarea id="comment-G" class="form-control" rows="6"></textarea>
                </section>

                <button type="submit" class="btn btn--save" id="saveBtn">この内容でスプレッドシートを更新</button>
            </form>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz9ACnaVJA0-WJSsSXUkfDCcre09URSMx0NkTp2p7HqlTqTy2w2ZCS_kT6nGaulh_3w2w/exec";
        
        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術の向上', '自己理解の深化']
        };

        function init() {
            let html = '';
            for (let key in evalConfig) {
                html += `<section class="card"><h2>${key}項目</h2>`;
                evalConfig[key].forEach((text, i) => {
                    html += `<div class="eval-row">
                        <div style="font-size:14px; flex:1;">${text}</div>
                        <div class="radio-group">${makeRadios(key+(i+1))}</div>
                    </div>`;
                });
                html += `<p style="margin-top:15px; font-weight:bold;">【${key} 所見】</p><textarea id="view-${key}" class="form-control"></textarea></section>`;
            }
            document.getElementById('dynamicSections').innerHTML = html;
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `
                <label style="font-size:12px; text-align:center;"><input type="radio" name="${name}" value="${v}" required><br>${v}</label>
            `).join('');
        }

        // ログイン処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('loginError');
            btn.disabled = true; btn.innerText = "認証中...";
            err.innerText = "";

            try {
                const response = await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        action: "login",
                        studentId: document.getElementById('studentId').value,
                        password: document.getElementById('password').value
                    })
                });
                const result = await response.json();

                if (result.success) {
                    document.getElementById('displayId').innerText = result.id;
                    document.getElementById('currentUserName').innerText = result.userName;
                    
                    // 以前のデータがあれば流し込む
                    if (result.savedData) fillForm(result.savedData);
                    
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                } else {
                    err.innerText = "学籍番号またはパスワードが正しくありません";
                }
            } catch(e) { err.innerText = "通信エラーが発生しました"; }
            btn.disabled = false; btn.innerText = "ログイン";
        });

        function fillForm(d) {
            const setVal = (id, val) => { if(document.getElementById(id)) document.getElementById(id).value = val || ""; };
            setVal('info_type', d[3]);
            setVal('info_owner', d[4]);
            setVal('info_facility', d[5]);
            setVal('info_address', d[6]);
            setVal('info_rep', d[7]);
            setVal('info_mentor', d[8]);
            setVal('date_start', d[9]);
            setVal('date_end', d[10]);
            if(d[11]) {
                const r = document.querySelector(`input[name="stay_type"][value="${d[11]}"]`);
                if(r) r.checked = true;
            }
            setVal('att_must', d[12]);
            setVal('att_done', d[13]);
            setVal('att_absent', d[14]);
            setVal('att_late', d[15]);
            setVal('att_early', d[16]);
            setVal('att_memo', d[17]);

            let col = 18;
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const val = d[col++];
                    const r = document.querySelector(`input[name="${key}${i+1}"][value="${val}"]`);
                    if(r) r.checked = true;
                });
                setVal(`view-${key}`, d[col++]);
            }
            const valE = d[col++];
            const rE = document.querySelector(`input[name="E"][value="${valE}"]`);
            if(rE) rE.checked = true;
            setVal('comment-F', d[col++]);
            setVal('comment-G', d[col++]);
        }

        // 保存（更新）処理
        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "スプレッドシートを更新中...";

            const formData = [
                document.getElementById('displayId').innerText,
                document.getElementById('currentUserName').innerText,
                "ソーシャルワーク実習",
                document.getElementById('info_type').value,
                document.getElementById('info_owner').value,
                document.getElementById('info_facility').value,
                document.getElementById('info_address').value,
                document.getElementById('info_rep').value,
                document.getElementById('info_mentor').value,
                document.getElementById('date_start').value,
                document.getElementById('date_end').value,
                (document.querySelector('input[name="stay_type"]:checked') || {}).value || "",
                document.getElementById('att_must').value,
                document.getElementById('att_done').value,
                document.getElementById('att_absent').value,
                document.getElementById('att_late').value,
                document.getElementById('att_early').value,
                document.getElementById('att_memo').value
            ];

            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const sel = document.querySelector(`input[name="${key}${i+1}"]:checked`);
                    formData.push(sel ? sel.value : "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            formData.push((document.querySelector('input[name="E"]:checked') || {}).value || "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData }) });
                alert("データを正常に更新しました！");
            } catch(e) { alert("更新に失敗しました。再度お試しください。"); }
            btn.disabled = false; btn.innerText = "この内容でスプレッドシートを更新";
        });

        init();
    </script>
</body>
</html>                    <input type="text" id="studentId" class="form-control" required>
                </div>
                <div style="margin-bottom:20px;">
                    <label>パスワード</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn--primary" id="loginBtn">ログイン</button>
                <p id="loginError" style="color:red; text-align:center; margin-top:15px;"></p>
            </form>
        </div>
    </div>

    <div id="mainApp" class="screen">
        <div class="app-container">
            <header style="display:flex; justify-content: space-between; background:white; padding:15px; border-radius:8px; margin-bottom:20px;">
                <div><strong>学籍番号:</strong> <span id="displayId"></span><br><strong>氏名:</strong> <span id="currentUserName"></span></div>
                <button onclick="location.reload()" class="btn" style="background:#dc3545; color:white; padding:8px 15px;">ログアウト</button>
            </header>

            <form id="evaluationForm">
                <section class="card">
                    <h2>施設・機関情報</h2>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>種別</label><input type="text" id="info_type" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>設置主体名</label><input type="text" id="info_owner" class="form-control"></div>
                    </div>
                    <div style="margin-bottom:10px;"><label>施設・機関名</label><input type="text" id="info_facility" class="form-control"></div>
                    <div style="margin-bottom:10px;"><label>所在地</label><input type="text" id="info_address" class="form-control"></div>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>代表者</label><input type="text" id="info_rep" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>実習指導者</label><input type="text" id="info_mentor" class="form-control"></div>
                    </div>
                </section>

                <section class="card">
                    <h2>実習期間・出席状況</h2>
                    <div class="grid-2">
                        <div style="margin-bottom:10px;"><label>開始日</label><input type="date" id="date_start" class="form-control"></div>
                        <div style="margin-bottom:10px;"><label>終了日</label><input type="date" id="date_end" class="form-control"></div>
                    </div>
                    <div style="margin-bottom:15px;">
                        <label>通い・宿泊の別：</label>
                        <input type="radio" name="stay_type" value="通い" id="stay_1"> <label for="stay_1">通い</label>
                        <input type="radio" name="stay_type" value="宿泊" id="stay_2" style="margin-left:15px;"> <label for="stay_2">宿泊</label>
                    </div>
                    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap:10px;">
                        <div><label style="font-size:12px;">出席すべき日数</label><input type="number" id="att_must" class="form-control"></div>
                        <div><label style="font-size:12px;">出席日数</label><input type="number" id="att_done" class="form-control"></div>
                        <div><label style="font-size:12px;">欠席</label><input type="number" id="att_absent" class="form-control"></div>
                        <div><label style="font-size:12px;">遅刻</label><input type="number" id="att_late" class="form-control"></div>
                        <div><label style="font-size:12px;">早退</label><input type="number" id="att_early" class="form-control"></div>
                    </div>
                </section>

                <div id="dynamicSections"></div>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around; padding: 10px;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 総評 / Ｇ アドバイス</h2>
                    <label>Ｆ 実習生に関する総評</label>
                    <textarea id="comment-F" class="form-control" rows="6" style="margin-bottom:20px;"></textarea>
                    <label>Ｇ 今後の学習に対するアドバイス</label>
                    <textarea id="comment-G" class="form-control" rows="6"></textarea>
                </section>

                <button type="submit" class="btn btn--save" id="saveBtn">この内容でスプレッドシートを更新</button>
            </form>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzY195vBMSeN3_7mCzrefzRK6fPllgyZdevKxsalc0iBMecZ-cwbKjruTOw688B04AiWA/exec";
        
        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術の向上', '自己理解の深化']
        };

        function init() {
            let html = '';
            for (let key in evalConfig) {
                html += `<section class="card"><h2>${key}項目</h2>`;
                evalConfig[key].forEach((text, i) => {
                    html += `<div class="eval-row">
                        <div style="font-size:14px; flex:1;">${text}</div>
                        <div class="radio-group">${makeRadios(key+(i+1))}</div>
                    </div>`;
                });
                html += `<p style="margin-top:15px; font-weight:bold;">【${key} 所見】</p><textarea id="view-${key}" class="form-control"></textarea></section>`;
            }
            document.getElementById('dynamicSections').innerHTML = html;
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `
                <label style="font-size:12px; text-align:center;"><input type="radio" name="${name}" value="${v}" required><br>${v}</label>
            `).join('');
        }

        // ログイン処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('loginError');
            btn.disabled = true; btn.innerText = "認証中...";
            err.innerText = "";

            try {
                const response = await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        action: "login",
                        studentId: document.getElementById('studentId').value,
                        password: document.getElementById('password').value
                    })
                });
                const result = await response.json();

                if (result.success) {
                    document.getElementById('displayId').innerText = result.id;
                    document.getElementById('currentUserName').innerText = result.userName;
                    
                    // 以前のデータがあれば流し込む
                    if (result.savedData) fillForm(result.savedData);
                    
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                } else {
                    err.innerText = "学籍番号またはパスワードが正しくありません";
                }
            } catch(e) { err.innerText = "通信エラーが発生しました"; }
            btn.disabled = false; btn.innerText = "ログイン";
        });

        function fillForm(d) {
            const setVal = (id, val) => { if(document.getElementById(id)) document.getElementById(id).value = val || ""; };
            setVal('info_type', d[3]);
            setVal('info_owner', d[4]);
            setVal('info_facility', d[5]);
            setVal('info_address', d[6]);
            setVal('info_rep', d[7]);
            setVal('info_mentor', d[8]);
            setVal('date_start', d[9]);
            setVal('date_end', d[10]);
            if(d[11]) {
                const r = document.querySelector(`input[name="stay_type"][value="${d[11]}"]`);
                if(r) r.checked = true;
            }
            setVal('att_must', d[12]);
            setVal('att_done', d[13]);
            setVal('att_absent', d[14]);
            setVal('att_late', d[15]);
            setVal('att_early', d[16]);
            setVal('att_memo', d[17]);

            let col = 18;
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const val = d[col++];
                    const r = document.querySelector(`input[name="${key}${i+1}"][value="${val}"]`);
                    if(r) r.checked = true;
                });
                setVal(`view-${key}`, d[col++]);
            }
            const valE = d[col++];
            const rE = document.querySelector(`input[name="E"][value="${valE}"]`);
            if(rE) rE.checked = true;
            setVal('comment-F', d[col++]);
            setVal('comment-G', d[col++]);
        }

        // 保存（更新）処理
        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "スプレッドシートを更新中...";

            const formData = [
                document.getElementById('displayId').innerText,
                document.getElementById('currentUserName').innerText,
                "ソーシャルワーク実習",
                document.getElementById('info_type').value,
                document.getElementById('info_owner').value,
                document.getElementById('info_facility').value,
                document.getElementById('info_address').value,
                document.getElementById('info_rep').value,
                document.getElementById('info_mentor').value,
                document.getElementById('date_start').value,
                document.getElementById('date_end').value,
                (document.querySelector('input[name="stay_type"]:checked') || {}).value || "",
                document.getElementById('att_must').value,
                document.getElementById('att_done').value,
                document.getElementById('att_absent').value,
                document.getElementById('att_late').value,
                document.getElementById('att_early').value,
                document.getElementById('att_memo').value
            ];

            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const sel = document.querySelector(`input[name="${key}${i+1}"]:checked`);
                    formData.push(sel ? sel.value : "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            formData.push((document.querySelector('input[name="E"]:checked') || {}).value || "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData }) });
                alert("データを正常に更新しました！");
            } catch(e) { alert("更新に失敗しました。再度お試しください。"); }
            btn.disabled = false; btn.innerText = "この内容でスプレッドシートを更新";
        });

        init();
    </script>
</body>
</html>            </div>
        </div>

        <div id="mainApp" class="screen">
            <header style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div><strong>学籍番号:</strong> <span id="displayId"></span><br><strong>氏名:</strong> <span id="currentUserName"></span></div>
                <button onclick="location.reload()" class="btn" style="background:#666; color:white;">ログアウト</button>
            </header>

            <form id="evaluationForm">
                <section class="card">
                    <h2>施設・指導者情報</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>種別</label><input type="text" id="info_type" class="form-control"></div>
                        <div class="form-group"><label>設置主体名</label><input type="text" id="info_owner" class="form-control"></div>
                    </div>
                    <div class="form-group"><label>施設・機関名</label><input type="text" id="info_facility" class="form-control"></div>
                    <div class="form-group"><label>所在地</label><input type="text" id="info_address" class="form-control"></div>
                    <div class="grid-2">
                        <div class="form-group"><label>代表者</label><input type="text" id="info_rep" class="form-control"></div>
                        <div class="form-group"><label>実習指導者</label><input type="text" id="info_mentor" class="form-control"></div>
                    </div>
                </section>

                <section class="card">
                    <h2>実習期間・出席状況</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>開始日</label><input type="date" id="date_start" class="form-control"></div>
                        <div class="form-group"><label>終了日</label><input type="date" id="date_end" class="form-control"></div>
                    </div>
                    <div class="form-group">
                        <label>通い・宿泊の別</label><br>
                        <input type="radio" name="stay_type" value="通い" id="stay_1"> <label for="stay_1">通い</label>
                        <input type="radio" name="stay_type" value="宿泊" id="stay_2" style="margin-left:20px;"> <label for="stay_2">宿泊</label>
                    </div>
                    <div class="grid-att">
                        <div class="form-group"><label>出席すべき日数</label><input type="number" id="att_must" class="form-control"></div>
                        <div class="form-group"><label>出席した日数</label><input type="number" id="att_done" class="form-control"></div>
                        <div class="form-group"><label>欠席日数</label><input type="number" id="att_absent" class="form-control"></div>
                        <div class="form-group"><label>遅刻日数</label><input type="number" id="att_late" class="form-control"></div>
                        <div class="form-group"><label>早退日数</label><input type="number" id="att_early" class="form-control"></div>
                    </div>
                    <div class="form-group"><label>備考（補充日 等）</label><input type="text" id="att_memo" class="form-control"></div>
                </section>

                <div id="dynamicSections"></div>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 実習生に関する総評</h2>
                    <textarea id="comment-F" class="form-control" rows="8"></textarea>
                </section>

                <section class="card">
                    <h2>Ｇ 今後の学習に対するアドバイス</h2>
                    <textarea id="comment-G" class="form-control" rows="8"></textarea>
                </section>

                <button type="submit" class="btn btn--success" id="saveBtn">スプレッドシートへ保存</button>
            </form>
        </div>
    </div>

    <script>
        // ★重要：デプロイしたURLを貼り付けてください
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzBuU4I8fuECSldym_-c2KDY8gVFGCwAIyjZdMqWr5nH88u9xiqgBbU71ylaA56GQyy8A/exec";

        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術の向上', '自己理解の深化']
        };

        let currentUser = { id: "", name: "" };

        function init() {
            let html = '';
            for (let key in evalConfig) {
                html += `<section class="card"><h2>${key}項目</h2>`;
                evalConfig[key].forEach((text, i) => {
                    html += `<div class="eval-row"><div class="eval-label">${text}</div><div class="radio-group">${makeRadios(key+(i+1))}</div></div>`;
                });
                html += `<p>【${key} 所見】</p><textarea id="view-${key}" class="form-control"></textarea></section>`;
            }
            document.getElementById('dynamicSections').innerHTML = html;
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `<label style="text-align:center"><input type="radio" name="${name}" value="${v}" required><br>${v}</label>`).join('');
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            btn.disabled = true; btn.innerText = "認証中...";
            
            try {
                const response = await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({ 
                        action: "login", 
                        studentId: document.getElementById('studentId').value, 
                        password: document.getElementById('password').value 
                    })
                });
                const result = await response.json();
                if (result.success) {
                    currentUser = { id: result.id, name: result.userName };
                    document.getElementById('displayId').innerText = result.id;
                    document.getElementById('currentUserName').innerText = result.userName;
                    if(result.savedData) fillForm(result.savedData);
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                } else {
                    document.getElementById('loginError').innerText = "ログイン失敗。ID/パスワードを確認してください。";
                }
            } catch(e) { alert("通信エラー: GASの設定を確認してください"); }
            btn.disabled = false; btn.innerText = "ログイン";
        });

        function fillForm(d) {
            const safeSet = (id, val) => { const el = document.getElementById(id); if(el) el.value = val || ""; };
            safeSet('info_type', d[3]);
            safeSet('info_owner', d[4]);
            safeSet('info_facility', d[5]);
            safeSet('info_address', d[6]);
            safeSet('info_rep', d[7]);
            safeSet('info_mentor', d[8]);
            safeSet('date_start', d[9]);
            safeSet('date_end', d[10]);
            if(d[11]) {
                const stayRad = document.querySelector(`input[name="stay_type"][value="${d[11]}"]`);
                if(stayRad) stayRad.checked = true;
            }
            safeSet('att_must', d[12]);
            safeSet('att_done', d[13]);
            safeSet('att_absent', d[14]);
            safeSet('att_late', d[15]);
            safeSet('att_early', d[16]);
            safeSet('att_memo', d[17]);

            let col = 18;
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const val = d[col++];
                    const rad = document.querySelector(`input[name="${key}${i+1}"][value="${val}"]`);
                    if(rad) rad.checked = true;
                });
                safeSet(`view-${key}`, d[col++]);
            }
            const valE = d[col++];
            const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
            if(radE) radE.checked = true;
            safeSet('comment-F', d[col++]);
            safeSet('comment-G', d[col++]);
        }

        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "保存中...";

            const formData = [
                currentUser.id, currentUser.name, "ソーシャルワーク実習",
                document.getElementById('info_type').value,
                document.getElementById('info_owner').value,
                document.getElementById('info_facility').value,
                document.getElementById('info_address').value,
                document.getElementById('info_rep').value,
                document.getElementById('info_mentor').value,
                document.getElementById('date_start').value,
                document.getElementById('date_end').value,
                (document.querySelector('input[name="stay_type"]:checked') || {}).value || "",
                document.getElementById('att_must').value,
                document.getElementById('att_done').value,
                document.getElementById('att_absent').value,
                document.getElementById('att_late').value,
                document.getElementById('att_early').value,
                document.getElementById('att_memo').value
            ];

            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    formData.push((document.querySelector(`input[name="${key}${i+1}"]:checked`) || {}).value || "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            formData.push((document.querySelector('input[name="E"]:checked') || {}).value || "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData }) });
                alert("保存完了しました");
            } catch(e) { alert("保存に失敗しました"); }
            btn.disabled = false; btn.innerText = "スプレッドシートへ保存";
        });

        init();
    </script>
</body>
</html>                    <button type="submit" class="btn btn--primary">ログイン</button>
                    <p id="loginError" style="color:red;"></p>
                </form>
            </div>
        </div>

        <div id="mainApp" class="screen">
            <header style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div><strong>学籍番号:</strong> <span id="displayId"></span><br><strong>氏名:</strong> <span id="currentUserName"></span></div>
                <button id="logoutBtn" class="btn" style="background:#666; color:white;">ログアウト</button>
            </header>

            <form id="evaluationForm">
                <section class="card">
                    <h2>施設・指導者情報</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>種別</label><input type="text" id="info_type" class="form-control"></div>
                        <div class="form-group"><label>設置主体名</label><input type="text" id="info_owner" class="form-control"></div>
                    </div>
                    <div class="form-group"><label>施設・機関名</label><input type="text" id="info_facility" class="form-control"></div>
                    <div class="form-group"><label>所在地</label><input type="text" id="info_address" class="form-control"></div>
                    <div class="grid-2">
                        <div class="form-group"><label>代表者</label><input type="text" id="info_rep" class="form-control"></div>
                        <div class="form-group"><label>実習指導者</label><input type="text" id="info_mentor" class="form-control"></div>
                    </div>
                </section>

                <section class="card">
                    <h2>実習期間・出席状況</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>開始日</label><input type="date" id="date_start" class="form-control"></div>
                        <div class="form-group"><label>終了日</label><input type="date" id="date_end" class="form-control"></div>
                    </div>
                    <div class="form-group">
                        <label>通い・宿泊の別</label><br>
                        <label><input type="radio" name="stay_type" value="通い"> 通い</label>
                        <label style="margin-left:20px;"><input type="radio" name="stay_type" value="宿泊"> 宿泊</label>
                    </div>
                    <div class="grid-出席">
                        <div class="form-group"><label>出席すべき日数</label><input type="number" id="att_must" class="form-control"></div>
                        <div class="form-group"><label>出席した日数</label><input type="number" id="att_done" class="form-control"></div>
                        <div class="form-group"><label>欠席日数</label><input type="number" id="att_absent" class="form-control"></div>
                        <div class="form-group"><label>遅刻日数</label><input type="number" id="att_late" class="form-control"></div>
                        <div class="form-group"><label>早退日数</label><input type="number" id="att_early" class="form-control"></div>
                    </div>
                    <div class="form-group"><label>備考（補充日 等）</label><input type="text" id="att_memo" class="form-control"></div>
                </section>

                <div id="dynamicSections"></div>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 実習生に関する総評</h2>
                    <textarea id="comment-F" class="form-control" rows="8"></textarea>
                </section>

                <section class="card">
                    <h2>Ｇ 今後の学習に対するアドバイス</h2>
                    <textarea id="comment-G" class="form-control" rows="8"></textarea>
                </section>

                <button type="submit" class="btn btn--success">スプレッドシートへ保存</button>
            </form>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzMdGi2SR1fC_wX-jLW0X9cQazodieegoiM6DllIvyPwxMFRuArbmB9R2YpehUxsANGcw/exec"; // デプロイしたURLを貼り付け
        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術・向上', '自己理解の深化']
        };

        let currentUser = { id: "", name: "" };

        function init() {
            let html = '';
            for (let key in evalConfig) {
                html += `<section class="card"><h2>${key}項目</h2>`;
                evalConfig[key].forEach((text, i) => {
                    html += `<div class="eval-row"><div class="eval-label">${text}</div><div class="radio-group">${makeRadios(key+(i+1))}</div></div>`;
                });
                html += `<p>【${key} 所見】</p><textarea id="view-${key}" class="form-control"></textarea></section>`;
            }
            document.getElementById('dynamicSections').innerHTML = html;
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `<label style="text-align:center"><input type="radio" name="${name}" value="${v}" required><br>${v}</label>`).join('');
        }

        // ログイン処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const res = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ 
                    action: "login", 
                    studentId: document.getElementById('studentId').value, 
                    password: document.getElementById('password').value 
                })
            });
            const result = await response.json();
            if (result.success) {
                currentUser = { id: result.id, name: result.userName };
                document.getElementById('displayId').innerText = result.id;
                document.getElementById('currentUserName').innerText = result.userName;
                if(result.savedData) fillForm(result.savedData);
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('mainApp').classList.add('active');
            } else {
                document.getElementById('loginError').innerText = "ログイン失敗";
            }
        });

        function fillForm(d) {
            // スプレッドシートのインデックスに合わせてセット（GAS側の配列順序と同期）
            document.getElementById('info_type').value = d[3];
            document.getElementById('info_owner').value = d[4];
            document.getElementById('info_facility').value = d[5];
            document.getElementById('info_address').value = d[6];
            document.getElementById('info_rep').value = d[7];
            document.getElementById('info_mentor').value = d[8];
            document.getElementById('date_start').value = d[9];
            document.getElementById('date_end').value = d[10];
            const stayRad = document.querySelector(`input[name="stay_type"][value="${d[11]}"]`);
            if(stayRad) stayRad.checked = true;
            document.getElementById('att_must').value = d[12];
            document.getElementById('att_done').value = d[13];
            document.getElementById('att_absent').value = d[14];
            document.getElementById('att_late').value = d[15];
            document.getElementById('att_early').value = d[16];
            document.getElementById('att_memo').value = d[17];
            // 評価項目以降（略: 同様のロジックで流し込み）
        }

        // 保存処理
        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true; btn.innerText = "保存中...";

            const formData = [
                currentUser.id, currentUser.name, "ソーシャルワーク実習",
                document.getElementById('info_type').value,
                document.getElementById('info_owner').value,
                document.getElementById('info_facility').value,
                document.getElementById('info_address').value,
                document.getElementById('info_rep').value,
                document.getElementById('info_mentor').value,
                document.getElementById('date_start').value,
                document.getElementById('date_end').value,
                (document.querySelector('input[name="stay_type"]:checked') || {}).value || "",
                document.getElementById('att_must').value,
                document.getElementById('att_done').value,
                document.getElementById('att_absent').value,
                document.getElementById('att_late').value,
                document.getElementById('att_early').value,
                document.getElementById('att_memo').value
            ];

            // 評価項目の追加
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    formData.push((document.querySelector(`input[name="${key}${i+1}"]:checked`) || {}).value || "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            formData.push((document.querySelector('input[name="E"]:checked') || {}).value || "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData }) });
                alert("保存完了しました");
            } catch(e) { alert("エラー"); }
            btn.disabled = false; btn.innerText = "スプレッドシートへ保存";
        });

        document.getElementById('logoutBtn').addEventListener('click', () => location.reload());
        init();
    </script>
</body>
</html>                    <button type="submit" class="btn btn--primary">ログイン</button>
                    <p id="loginError" style="color:red;"></p>
                </form>
            </div>
        </div>

        <div id="mainApp" class="screen">
            <header style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div><strong>学籍番号:</strong> <span id="displayId"></span><br><strong>氏名:</strong> <span id="currentUserName"></span></div>
                <button id="logoutBtn" class="btn" style="background:#666; color:white;">ログアウト</button>
            </header>

            <form id="evaluationForm">
                <section class="card">
                    <h2>施設・指導者情報</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>種別</label><input type="text" id="info_type" class="form-control"></div>
                        <div class="form-group"><label>設置主体名</label><input type="text" id="info_owner" class="form-control"></div>
                    </div>
                    <div class="form-group"><label>施設・機関名</label><input type="text" id="info_facility" class="form-control"></div>
                    <div class="form-group"><label>所在地</label><input type="text" id="info_address" class="form-control"></div>
                    <div class="grid-2">
                        <div class="form-group"><label>代表者</label><input type="text" id="info_rep" class="form-control"></div>
                        <div class="form-group"><label>実習指導者</label><input type="text" id="info_mentor" class="form-control"></div>
                    </div>
                </section>

                <section class="card">
                    <h2>実習期間・出席状況</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>開始日</label><input type="date" id="date_start" class="form-control"></div>
                        <div class="form-group"><label>終了日</label><input type="date" id="date_end" class="form-control"></div>
                    </div>
                    <div class="form-group">
                        <label>通い・宿泊の別</label><br>
                        <label><input type="radio" name="stay_type" value="通い"> 通い</label>
                        <label style="margin-left:20px;"><input type="radio" name="stay_type" value="宿泊"> 宿泊</label>
                    </div>
                    <div class="grid-出席">
                        <div class="form-group"><label>出席すべき日数</label><input type="number" id="att_must" class="form-control"></div>
                        <div class="form-group"><label>出席した日数</label><input type="number" id="att_done" class="form-control"></div>
                        <div class="form-group"><label>欠席日数</label><input type="number" id="att_absent" class="form-control"></div>
                        <div class="form-group"><label>遅刻日数</label><input type="number" id="att_late" class="form-control"></div>
                        <div class="form-group"><label>早退日数</label><input type="number" id="att_early" class="form-control"></div>
                    </div>
                    <div class="form-group"><label>備考（補充日 等）</label><input type="text" id="att_memo" class="form-control"></div>
                </section>

                <div id="dynamicSections"></div>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 実習生に関する総評</h2>
                    <textarea id="comment-F" class="form-control" rows="8"></textarea>
                </section>

                <section class="card">
                    <h2>Ｇ 今後の学習に対するアドバイス</h2>
                    <textarea id="comment-G" class="form-control" rows="8"></textarea>
                </section>

                <button type="submit" class="btn btn--success">スプレッドシートへ保存</button>
            </form>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzWiY3jR4a9bE4jovY7ERFL-fUCGMCUrOChKjqe2mI3zdVI0gC6UvnOMkeIq4UVhIDlXQ/exec"; // デプロイしたURLを貼り付け
        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術・向上', '自己理解の深化']
        };

        let currentUser = { id: "", name: "" };

        function init() {
            let html = '';
            for (let key in evalConfig) {
                html += `<section class="card"><h2>${key}項目</h2>`;
                evalConfig[key].forEach((text, i) => {
                    html += `<div class="eval-row"><div class="eval-label">${text}</div><div class="radio-group">${makeRadios(key+(i+1))}</div></div>`;
                });
                html += `<p>【${key} 所見】</p><textarea id="view-${key}" class="form-control"></textarea></section>`;
            }
            document.getElementById('dynamicSections').innerHTML = html;
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `<label style="text-align:center"><input type="radio" name="${name}" value="${v}" required><br>${v}</label>`).join('');
        }

        // ログイン処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const res = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ 
                    action: "login", 
                    studentId: document.getElementById('studentId').value, 
                    password: document.getElementById('password').value 
                })
            });
            const result = await response.json();
            if (result.success) {
                currentUser = { id: result.id, name: result.userName };
                document.getElementById('displayId').innerText = result.id;
                document.getElementById('currentUserName').innerText = result.userName;
                if(result.savedData) fillForm(result.savedData);
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('mainApp').classList.add('active');
            } else {
                document.getElementById('loginError').innerText = "ログイン失敗";
            }
        });

        function fillForm(d) {
            // スプレッドシートのインデックスに合わせてセット（GAS側の配列順序と同期）
            document.getElementById('info_type').value = d[3];
            document.getElementById('info_owner').value = d[4];
            document.getElementById('info_facility').value = d[5];
            document.getElementById('info_address').value = d[6];
            document.getElementById('info_rep').value = d[7];
            document.getElementById('info_mentor').value = d[8];
            document.getElementById('date_start').value = d[9];
            document.getElementById('date_end').value = d[10];
            const stayRad = document.querySelector(`input[name="stay_type"][value="${d[11]}"]`);
            if(stayRad) stayRad.checked = true;
            document.getElementById('att_must').value = d[12];
            document.getElementById('att_done').value = d[13];
            document.getElementById('att_absent').value = d[14];
            document.getElementById('att_late').value = d[15];
            document.getElementById('att_early').value = d[16];
            document.getElementById('att_memo').value = d[17];
            // 評価項目以降（略: 同様のロジックで流し込み）
        }

        // 保存処理
        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true; btn.innerText = "保存中...";

            const formData = [
                currentUser.id, currentUser.name, "ソーシャルワーク実習",
                document.getElementById('info_type').value,
                document.getElementById('info_owner').value,
                document.getElementById('info_facility').value,
                document.getElementById('info_address').value,
                document.getElementById('info_rep').value,
                document.getElementById('info_mentor').value,
                document.getElementById('date_start').value,
                document.getElementById('date_end').value,
                (document.querySelector('input[name="stay_type"]:checked') || {}).value || "",
                document.getElementById('att_must').value,
                document.getElementById('att_done').value,
                document.getElementById('att_absent').value,
                document.getElementById('att_late').value,
                document.getElementById('att_early').value,
                document.getElementById('att_memo').value
            ];

            // 評価項目の追加
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    formData.push((document.querySelector(`input[name="${key}${i+1}"]:checked`) || {}).value || "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            formData.push((document.querySelector('input[name="E"]:checked') || {}).value || "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "save", formData }) });
                alert("保存完了しました");
            } catch(e) { alert("エラー"); }
            btn.disabled = false; btn.innerText = "スプレッドシートへ保存";
        });

        document.getElementById('logoutBtn').addEventListener('click', () => location.reload());
        init();
    </script>
</body>
</html>                <h1>実習評価システム</h1>
                <p>学籍番号とパスワードでログインしてください</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label>学籍番号</label>
                        <input type="text" id="studentId" class="form-control" required placeholder="1234567">
                    </div><br>
                    <div class="form-group">
                        <label>パスワード</label>
                        <input type="password" id="password" class="form-control" required>
                    </div><br>
                    <button type="submit" class="btn btn--primary">ログイン</button>
                    <p id="loginError" style="color:red;"></p>
                </form>
            </div>
        </div>

        <div id="mainApp" class="screen">
            <header class="no-print" style="display:flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>学籍番号:</strong> <span id="displayId"></span><br>
                    <strong>氏名:</strong> <span id="currentUserName"></span> さん
                </div>
                <div>
                    <button onclick="window.print()" class="btn">印刷</button>
                    <button id="logoutBtn" class="btn">ログアウト</button>
                </div>
            </header>
            <hr class="no-print">

            <form id="evaluationForm">
                <section class="card">
                    <h2>Ａ 基本的知識の理解・習得の状況</h2>
                    <div id="section-A"></div>
                    <p>【A 所見】</p>
                    <textarea id="view-A" class="form-control" placeholder="具体的な状況を記入"></textarea>
                </section>

                <section class="card">
                    <h2>Ｂ 基本的技術・技能の習得の状況</h2>
                    <div id="section-B"></div>
                    <p>【B 所見】</p>
                    <textarea id="view-B" class="form-control"></textarea>
                </section>

                <section class="card">
                    <h2>Ｃ 実習態度の状況</h2>
                    <div id="section-C"></div>
                    <p>【C 所見】</p>
                    <textarea id="view-C" class="form-control"></textarea>
                </section>

                <section class="card">
                    <h2>Ｄ 実習を通した変容</h2>
                    <div id="section-D"></div>
                    <p>【D 所見】</p>
                    <textarea id="view-D" class="form-control"></textarea>
                </section>

                <section class="card">
                    <h2>Ｅ 総合評価</h2>
                    <div class="radio-group" id="group-E" style="justify-content: space-around; padding: 20px 0;"></div>
                </section>

                <section class="card">
                    <h2>Ｆ 実習生に関する総評</h2>
                    <textarea id="comment-F" class="form-control" rows="6"></textarea>
                </section>

                <section class="card">
                    <h2>Ｇ 今後の学習に対するアドバイス</h2>
                    <textarea id="comment-G" class="form-control" rows="6"></textarea>
                </section>

                <div class="form-actions no-print" style="text-align: center; margin-bottom: 50px;">
                    <button type="submit" class="btn btn--success" style="width: 100%;">評価データをスプレッドシートへ保存</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ★ここにデプロイしたGASのURLを貼り付けてください
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwDJG6ESS-UfFMQkh9JajGj8hHs1x5Y0rmC_mvb1rI9uAV4OqXP4xIumlbbfUnc1jK3Hw/exec";

        const evalConfig = {
            'A': ['利用者及び生活課題・ニーズの理解', '職種の業務内容に関する理解', '施設・機関の機構・機能の理解', '関連施設・制度・社会資源の理解'],
            'B': ['利用者への共感的・理解的な態度', '基本的技術（面接・記録等）の習得', '実習日誌・記録の作成能力'],
            'C': ['規則の遵守・マナー', '習得への意欲・積極性', '利用者への関わり', '人権・人格の尊重', '指導を求める態度', '他職種との協働'],
            'D': ['各自の実習目標達成度', '援助関係の深化', '実践現場の理解深化', '実践技術の向上', '自己理解の深化']
        };

        let currentUser = { id: "", name: "" };

        // フォーム生成
        function setupForm() {
            for (let key in evalConfig) {
                const container = document.getElementById(`section-${key}`);
                evalConfig[key].forEach((text, i) => {
                    const row = document.createElement('div');
                    row.className = 'eval-row';
                    row.innerHTML = `
                        <div class="eval-label">${text}</div>
                        <div class="radio-group">${makeRadios(key + (i+1))}</div>
                    `;
                    container.appendChild(row);
                });
            }
            document.getElementById('group-E').innerHTML = makeRadios('E');
        }

        function makeRadios(name) {
            return [5, 4, 3, 2, 1, '非該当'].map(v => `
                <label><input type="radio" name="${name}" value="${v}" required> ${v}</label>
            `).join('');
        }

        // ログイン処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const studentId = document.getElementById('studentId').value;
            const password = document.getElementById('password').value;
            const errorArea = document.getElementById('loginError');
            errorArea.innerText = "認証中...";

            try {
                const response = await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({ action: "login", studentId, password })
                });
                const result = await response.json();

                if (result.success) {
                    currentUser.id = studentId;
                    currentUser.name = result.userName;
                    document.getElementById('displayId').innerText = studentId;
                    document.getElementById('currentUserName').innerText = result.userName;
                    
                    if (result.savedData) fillData(result.savedData);
                    
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                } else {
                    errorArea.innerText = "IDまたはパスワードが違います";
                }
            } catch (err) {
                errorArea.innerText = "サーバー接続エラー";
            }
        });

        function fillData(data) {
            // スプレッドシートの列順序に合わせて復元
            // (学籍, 氏名, 科目, 施設, A1, A2... の順を想定)
            let col = 4; 
            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const val = data[col++];
                    const rad = document.querySelector(`input[name="${key}${i+1}"][value="${val}"]`);
                    if(rad) rad.checked = true;
                });
                document.getElementById(`view-${key}`).value = data[col++] || "";
            }
            const valE = data[col++];
            const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
            if(radE) radE.checked = true;
            document.getElementById('comment-F').value = data[col++] || "";
            document.getElementById('comment-G').value = data[col++] || "";
        }

        // 保存処理
        document.getElementById('evaluationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true;
            btn.innerText = "保存中...";

            const formData = [
                currentUser.id, currentUser.name, "ソーシャルワーク実習", "実習施設名"
            ];

            for (let key in evalConfig) {
                evalConfig[key].forEach((_, i) => {
                    const sel = document.querySelector(`input[name="${key}${i+1}"]:checked`);
                    formData.push(sel ? sel.value : "");
                });
                formData.push(document.getElementById(`view-${key}`).value);
            }
            const selE = document.querySelector(`input[name="E"]:checked`);
            formData.push(selE ? selE.value : "");
            formData.push(document.getElementById('comment-F').value);
            formData.push(document.getElementById('comment-G').value);

            try {
                await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({ action: "save", formData })
                });
                alert("評価データを更新しました！");
            } catch (err) {
                alert("保存に失敗しました");
            } finally {
                btn.disabled = false;
                btn.innerText = "評価データをスプレッドシートへ保存";
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => location.reload());
        setupForm();
    </script>
</body>
</html>        <button class="button is-light" onclick="window.print()">印刷</button>
      </div>
    </div>

    <div class="box is-light">
      <p><strong>学籍番号:</strong> <span id="view-st-id"></span></p>
      <p><strong>氏名:</strong> <span id="view-st-name"></span></p>
    </div>

    <div id="dynamic-form"></div>

    <div class="section-title">Ｅ 総合評価</div>
    <div id="radio-E" class="p-3"></div>

    <div class="section-title">Ｆ 総評</div>
    <textarea id="text-F" class="textarea" rows="4"></textarea>

    <div class="section-title">Ｇ アドバイス</div>
    <textarea id="text-G" class="textarea" rows="4"></textarea>

    <div class="mt-6 no-print">
      <button class="button is-primary is-large is-fullwidth" onclick="onSave()">スプレッドシートに保存</button>
    </div>
  </div>

<script>
  // ★ここに新しいURLを貼り付け
  const GAS_URL = "https://script.google.com/macros/s/AKfycbz9ACnaVJA0-WJSsSXUkfDCcre09URSMx0NkTp2p7HqlTqTy2w2ZCS_kT6nGaulh_3w2w/exec";

  const config = [
    { id: 'A', title: '基本的知識', items: ['利用者課題理解', '業務内容理解', '組織・機能理解', '社会資源理解'] },
    { id: 'B', title: '基本的技術', items: ['共感的態度', '技術習得', '記録能力'] },
    { id: 'C', title: '実習態度', items: ['マナー', '意欲', '関わり', '人権尊重', '指導を仰ぐ', '協働'] },
    { id: 'D', title: '変容', items: ['目標達成', '援助関係', '現場理解', '技術向上', '自己理解'] }
  ];

  function initForm() {
    let html = '';
    config.forEach(sec => {
      html += `<div class="section-title">${sec.id} ${sec.title}</div><table class="table is-fullwidth eval-table">`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</table><label class="label is-small">所見</label><textarea class="textarea mb-4" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('dynamic-form').innerHTML = html;
    document.getElementById('radio-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5,4,3,2,1,'非該当'].map(v => 
      `<label class="radio mr-2"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  async function callGAS(payload) {
    // 外部通信(fetch)の設定
    const response = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "text/plain;charset=utf-8" }
    });
    return await response.json();
  }

  async function onLogin() {
    const id = document.getElementById('user-id').value;
    const pass = document.getElementById('user-pw').value;
    const btn = document.getElementById('btn-login');

    if(!id || !pass) return alert("入力してください");
    btn.classList.add('is-loading');

    try {
      const res = await callGAS({ method: 'login', id: id, pass: pass });
      if(res.success) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'block';
        document.getElementById('view-st-id').innerText = res.user.id;
        document.getElementById('view-st-name').innerText = res.user.name;
        if(res.savedData) loadSavedData(res.savedData);
      } else {
        alert("ログインに失敗しました。学籍番号かパスワードが違います。");
      }
    } catch(e) {
      alert("通信エラーが発生しました。GASのデプロイ設定(全員)を確認してください。\n" + e);
    } finally {
      btn.classList.remove('is-loading');
    }
  }

  function loadSavedData(data) {
    let idx = 4; // 学籍番号, 氏名, 科目, 施設の後から
    config.forEach(sec => {
      sec.items.forEach((_, i) => {
        const val = data[idx++];
        const rad = document.querySelector(`input[name="${sec.id}${i+1}"][value="${val}"]`);
        if(rad) rad.checked = true;
      });
      document.getElementById('view-' + sec.id).value = data[idx++] || "";
    });
    const valE = data[idx++];
    const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
    if(radE) radE.checked = true;
    document.getElementById('text-F').value = data[idx++] || "";
    document.getElementById('text-G').value = data[idx++] || "";
  }

  async function onSave() {
    const id = document.getElementById('view-st-id').innerText;
    const name = document.getElementById('view-st-name').innerText;
    let formData = [id, name, "ソーシャルワーク実習", "実習施設名"];

    config.forEach(sec => {
      sec.items.forEach((_, i) => {
        const sel = document.querySelector(`input[name="${sec.id}${i+1}"]:checked`);
        formData.push(sel ? sel.value : "");
      });
      formData.push(document.getElementById('view-' + sec.id).value);
    });

    const selE = document.querySelector(`input[name="E"]:checked`);
    formData.push(selE ? selE.value : "");
    formData.push(document.getElementById('text-F').value);
    formData.push(document.getElementById('text-G').value);

    try {
      const res = await callGAS({ method: 'save', formData: formData });
      alert(res.message);
    } catch(e) {
      alert("保存エラー: " + e);
    }
  }

  initForm();
</script>
</body>
</html>    </div>
    <div class="notification is-light">
      学籍番号: <span id="st-id"></span> / 氏名: <span id="st-name"></span>
    </div>
    <div id="form-content"></div>
    <div class="section-header">Ｅ 総合評価</div>
    <div id="eval-E" class="p-3"></div>
    <div class="section-header">Ｆ 総評</div>
    <textarea class="textarea mt-2" id="comment-F"></textarea>
    <div class="section-header">Ｇ アドバイス</div>
    <textarea class="textarea mt-2" id="comment-G"></textarea>
    <button class="button is-primary is-large is-fullwidth mt-5 no-print" onclick="handleSave()">保存する</button>
  </div>

<script>
  // ★重要：ここにあなたのデプロイURLを貼り付けてください
  const GAS_URL = "https://script.google.com/macros/s/AKfycbwnBwlwhWG8f6mePyO38cdjJ8xEff2QUdJPb7tDbntjawqH-wy_RPa9ppejaSM63KrIrA/exec";

  const sections = [
    { id: 'A', title: '基本的知識', items: ['利用者理解', '業務理解', '組織理解', '資源理解'] },
    { id: 'B', title: '基本的技術', items: ['共感的態度', '技術習得', '記録能力'] },
    { id: 'C', title: '実習態度', items: ['規則遵守', '意欲', '積極性', '人権尊重', '指導を仰ぐ', '協働'] },
    { id: 'D', title: '変容', items: ['目標達成', '援助関係', '現場理解', '技術向上', '自己理解'] }
  ];

  function init() {
    let html = '';
    sections.forEach(sec => {
      html += `<div class="section-header">${sec.title}</div><table class="table is-fullwidth eval-table">`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</table><label class="label is-small">所見</label><textarea class="textarea mb-3" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('form-content').innerHTML = html;
    document.getElementById('eval-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5, 4, 3, 2, 1, '非該当'].map(v => 
      `<label class="radio mr-2"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  // GASと通信する汎用関数 (fetchを使用)
  async function callGAS(data) {
    const response = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
    return await response.json();
  }

  async function handleLogin() {
    const id = document.getElementById('login-id').value;
    const pass = document.getElementById('login-pw').value;
    const btn = document.getElementById('login-btn');
    
    btn.classList.add('is-loading');
    try {
      const res = await callGAS({ method: 'login', id: id, pass: pass });
      if (res.success) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('st-id').innerText = res.user.id;
        document.getElementById('st-name').innerText = res.user.name;
        // 保存データがあれば反映（実装略）
      } else { alert("ログイン失敗"); }
    } catch (e) { alert("エラー: " + e); }
    btn.classList.remove('is-loading');
  }

  async function handleSave() {
    // フォームからデータを集める処理 (以前のロジックと同じ)
    const id = document.getElementById('st-id').innerText;
    let payload = [id, document.getElementById('st-name').innerText, "SW実習", "施設名"];
    // ...各項目のpush処理...
    
    const res = await callGAS({ method: 'save', formData: payload });
    alert(res.message);
  }

  init();
</script>
</body>
</html>        <button class="button is-light" onclick="window.print()">印刷する</button>
      </div>
    </div>

    <div class="columns is-bordered mb-4" style="border: 2px solid #000; padding: 10px;">
      <div class="column"><strong>大学：</strong>種智院大学 [cite: 2]</div>
      <div class="column"><strong>学籍番号：</strong><span id="st-id"></span></div>
      <div class="column"><strong>氏名：</strong><span id="st-name"></span></div>
      <div class="column"><strong>科目名：</strong>ソーシャルワーク実習 [cite: 2]</div>
    </div>

    <p class="is-size-7 mb-4">※ 5：大変よい / 4：よい / 3：ふつう / 2：努力を要する / 1：かなり努力を要する / 非該当 [cite: 10]</p>

    <div id="form-content"></div>

    <div class="section-header">Ｅ 総合評価 [cite: 25]</div>
    <div class="p-3 box mt-2" id="eval-E"></div>

    <div class="section-header">Ｆ 実習生に関する総評 [cite: 27]</div>
    <textarea class="textarea mt-2" id="comment-F" rows="4"></textarea>

    <div class="section-header">Ｇ アドバイス・長所・短所 [cite: 28]</div>
    <textarea class="textarea mt-2" id="comment-G" rows="4"></textarea>

    <div class="mt-6 has-text-centered no-print">
      <p class="help mb-3">入力を完了したら「保存」ボタンを押してください。</p>
      <button class="button is-large is-primary" onclick="handleSave()">データをスプレッドシートへ保存</button>
    </div>
  </div>

<script>
  const sections = [
    { id: 'A', title: '基本的知識の理解・習得の状況', items: [
      '施設・機関の利用者及びその生活課題・ニーズに関する理解 [cite: 14]',
      '実習した職種の業務内容に関する理解 [cite: 14]',
      '施設・機関の法的根拠・目的・組織・業務体系等に対する理解 [cite: 14]',
      '関連する他施設・制度・社会資源に関する理解 [cite: 14]'
    ]},
    { id: 'B', title: '基本的技術・技能の習得の状況', items: [
      '利用者に対して共感的・理解的に接する技能 [cite: 17]',
      '基本的技術（面接、観察、ケア、環境設備等）の習得 [cite: 17]',
      '実習日誌や各種記録を的確に作成する能力 [cite: 17]'
    ]},
    { id: 'C', title: '実習態度の状況', items: [
      '規則の遵守（適切な服装、言葉遣い等、マナーも含む） [cite: 20]',
      '職務を習得しようとする意欲、積極性 [cite: 20]',
      '利用者に積極的に関わろうとする態度 [cite: 20]',
      '利用者の人権・人格を尊重しようとする態度 [cite: 20]',
      '実習指導者の指導・助言を積極的に求めようとする態度 [cite: 20]',
      '他職種、他職員と協働しようとする態度 [cite: 20]'
    ]},
    { id: 'D', title: '実習を通した変容', items: [
      '各自の実習目標の達成度 [cite: 23]',
      '利用者とそのニーズに対する理解や援助関係を深めた [cite: 23]',
      '実践現場に関する理解を深めた [cite: 23]',
      '実践技術・技能を深めた [cite: 23]',
      '自己理解を深めた [cite: 23]'
    ]}
  ];

  function init() {
    let html = '';
    sections.forEach(sec => {
      html += `<div class="section-header">${sec.id} ${sec.title}</div>`;
      html += `<table class="table is-fullwidth eval-table"><thead><tr><th>評価項目</th><th>評定尺度 [cite: 10]</th></tr></thead><tbody>`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</tbody></table><label class="label is-small">【${sec.id} 所見】</label><textarea class="textarea mb-3" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('form-content').innerHTML = html;
    document.getElementById('eval-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5, 4, 3, 2, 1, '非該当'].map(v => 
      `<label class="radio-label"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  function handleLogin() {
    const id = document.getElementById('login-id').value;
    const pw = document.getElementById('login-pw').value;
    google.script.run.withSuccessHandler(res => {
      if(res.success) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('st-id').innerText = res.user.id;
        document.getElementById('st-name').innerText = res.user.name;
        if(res.savedData) loadData(res.savedData);
      } else { alert("ログイン情報が正しくありません。"); }
    }).login(id, pw);
  }

  function loadData(data) {
    // スプレッドシートの各列(A-G)をフォームに復元
    // data[0]=学籍番号, data[1]=氏名... A1はdata[4]から開始
    let idx = 4;
    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const val = data[idx++];
        const rad = document.querySelector(`input[name="${sec.id}${i+1}"][value="${val}"]`);
        if(rad) rad.checked = true;
      });
      document.getElementById('view-' + sec.id).value = data[idx++];
    });
    // E, F, Gの復元
    const valE = data[idx++];
    const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
    if(radE) radE.checked = true;
    document.getElementById('comment-F').value = data[idx++];
    document.getElementById('comment-G').value = data[idx++];
  }

  function handleSave() {
    const id = document.getElementById('st-id').innerText;
    const name = document.getElementById('st-name').innerText;
    let payload = [id, name, "ソーシャルワーク実習", "実習施設名"];

    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const sel = document.querySelector(`input[name="${sec.id}${i+1}"]:checked`);
        payload.push(sel ? sel.value : "");
      });
      payload.push(document.getElementById('view-' + sec.id).value);
    });

    const selE = document.querySelector(`input[name="E"]:checked`);
    payload.push(selE ? selE.value : "");
    payload.push(document.getElementById('comment-F').value);
    payload.push(document.getElementById('comment-G').value);

    google.script.run.withSuccessHandler(msg => alert(msg)).saveData(payload);
  }

  init();
</script>
</body>
</html>        <button class="button is-light" onclick="window.print()">印刷する</button>
      </div>
    </div>

    <div class="columns is-bordered mb-4" style="border: 2px solid #000; padding: 10px;">
      <div class="column"><strong>大学：</strong>種智院大学 [cite: 2]</div>
      <div class="column"><strong>学籍番号：</strong><span id="st-id"></span></div>
      <div class="column"><strong>氏名：</strong><span id="st-name"></span></div>
      <div class="column"><strong>科目名：</strong>ソーシャルワーク実習 [cite: 2]</div>
    </div>

    <p class="is-size-7 mb-4">※ 5：大変よい / 4：よい / 3：ふつう / 2：努力を要する / 1：かなり努力を要する / 非該当 [cite: 10]</p>

    <div id="form-content"></div>

    <div class="section-header">Ｅ 総合評価 [cite: 25]</div>
    <div class="p-3 box mt-2" id="eval-E"></div>

    <div class="section-header">Ｆ 実習生に関する総評 [cite: 27]</div>
    <textarea class="textarea mt-2" id="comment-F" rows="4"></textarea>

    <div class="section-header">Ｇ アドバイス・長所・短所 [cite: 28]</div>
    <textarea class="textarea mt-2" id="comment-G" rows="4"></textarea>

    <div class="mt-6 has-text-centered no-print">
      <p class="help mb-3">入力を完了したら「保存」ボタンを押してください。</p>
      <button class="button is-large is-primary" onclick="handleSave()">データをスプレッドシートへ保存</button>
    </div>
  </div>

<script>
  const sections = [
    { id: 'A', title: '基本的知識の理解・習得の状況', items: [
      '施設・機関の利用者及びその生活課題・ニーズに関する理解 [cite: 14]',
      '実習した職種の業務内容に関する理解 [cite: 14]',
      '施設・機関の法的根拠・目的・組織・業務体系等に対する理解 [cite: 14]',
      '関連する他施設・制度・社会資源に関する理解 [cite: 14]'
    ]},
    { id: 'B', title: '基本的技術・技能の習得の状況', items: [
      '利用者に対して共感的・理解的に接する技能 [cite: 17]',
      '基本的技術（面接、観察、ケア、環境設備等）の習得 [cite: 17]',
      '実習日誌や各種記録を的確に作成する能力 [cite: 17]'
    ]},
    { id: 'C', title: '実習態度の状況', items: [
      '規則の遵守（適切な服装、言葉遣い等、マナーも含む） [cite: 20]',
      '職務を習得しようとする意欲、積極性 [cite: 20]',
      '利用者に積極的に関わろうとする態度 [cite: 20]',
      '利用者の人権・人格を尊重しようとする態度 [cite: 20]',
      '実習指導者の指導・助言を積極的に求めようとする態度 [cite: 20]',
      '他職種、他職員と協働しようとする態度 [cite: 20]'
    ]},
    { id: 'D', title: '実習を通した変容', items: [
      '各自の実習目標の達成度 [cite: 23]',
      '利用者とそのニーズに対する理解や援助関係を深めた [cite: 23]',
      '実践現場に関する理解を深めた [cite: 23]',
      '実践技術・技能を深めた [cite: 23]',
      '自己理解を深めた [cite: 23]'
    ]}
  ];

  function init() {
    let html = '';
    sections.forEach(sec => {
      html += `<div class="section-header">${sec.id} ${sec.title}</div>`;
      html += `<table class="table is-fullwidth eval-table"><thead><tr><th>評価項目</th><th>評定尺度 [cite: 10]</th></tr></thead><tbody>`;
      sec.items.forEach((item, i) => {
        html += `<tr><td>${item}</td><td>${makeRadios(sec.id + (i+1))}</td></tr>`;
      });
      html += `</tbody></table><label class="label is-small">【${sec.id} 所見】</label><textarea class="textarea mb-3" id="view-${sec.id}"></textarea>`;
    });
    document.getElementById('form-content').innerHTML = html;
    document.getElementById('eval-E').innerHTML = makeRadios('E');
  }

  function makeRadios(name) {
    return [5, 4, 3, 2, 1, '非該当'].map(v => 
      `<label class="radio-label"><input type="radio" name="${name}" value="${v}"> ${v}</label>`
    ).join('');
  }

  function handleLogin() {
    const id = document.getElementById('login-id').value;
    const pw = document.getElementById('login-pw').value;
    google.script.run.withSuccessHandler(res => {
      if(res.success) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('st-id').innerText = res.user.id;
        document.getElementById('st-name').innerText = res.user.name;
        if(res.savedData) loadData(res.savedData);
      } else { alert("ログイン情報が正しくありません。"); }
    }).login(id, pw);
  }

  function loadData(data) {
    // スプレッドシートの各列(A-G)をフォームに復元
    // data[0]=学籍番号, data[1]=氏名... A1はdata[4]から開始
    let idx = 4;
    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const val = data[idx++];
        const rad = document.querySelector(`input[name="${sec.id}${i+1}"][value="${val}"]`);
        if(rad) rad.checked = true;
      });
      document.getElementById('view-' + sec.id).value = data[idx++];
    });
    // E, F, Gの復元
    const valE = data[idx++];
    const radE = document.querySelector(`input[name="E"][value="${valE}"]`);
    if(radE) radE.checked = true;
    document.getElementById('comment-F').value = data[idx++];
    document.getElementById('comment-G').value = data[idx++];
  }

  function handleSave() {
    const id = document.getElementById('st-id').innerText;
    const name = document.getElementById('st-name').innerText;
    let payload = [id, name, "ソーシャルワーク実習", "実習施設名"];

    sections.forEach(sec => {
      sec.items.forEach((_, i) => {
        const sel = document.querySelector(`input[name="${sec.id}${i+1}"]:checked`);
        payload.push(sel ? sel.value : "");
      });
      payload.push(document.getElementById('view-' + sec.id).value);
    });

    const selE = document.querySelector(`input[name="E"]:checked`);
    payload.push(selE ? selE.value : "");
    payload.push(document.getElementById('comment-F').value);
    payload.push(document.getElementById('comment-G').value);

    google.script.run.withSuccessHandler(msg => alert(msg)).saveData(payload);
  }

  init();
</script>
</body>
</html>
